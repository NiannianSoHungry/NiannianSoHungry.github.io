{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/img/avatar.jpg","path":"img/avatar.jpg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg","path":"img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg","path":"img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg","path":"img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg","path":"img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg","path":"img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg","path":"img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg","modified":0,"renderable":0},{"_id":"source/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg","path":"img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg","modified":0,"renderable":0},{"_id":"node_modules/hexo-theme-aurora/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/icons/favicon-16x16.png","path":"icons/favicon-16x16.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/icons/favicon-32x32.png","path":"icons/favicon-32x32.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/886a749e.css","path":"static/886a749e.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/css/3e25f349.css","path":"static/css/3e25f349.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/css/882f9706.css","path":"static/css/882f9706.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/css/6b275704.css","path":"static/css/6b275704.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/css/8e0e69c4.css","path":"static/css/8e0e69c4.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/css/9a0271b0.css","path":"static/css/9a0271b0.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/css/a14e1a22.css","path":"static/css/a14e1a22.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/img/dccf965f.jpg","path":"static/img/dccf965f.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/120aa8f8.js","path":"static/js/120aa8f8.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/22ac7e7f.js","path":"static/js/22ac7e7f.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/36429e9b.js","path":"static/js/36429e9b.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/53ed1a6f.js","path":"static/js/53ed1a6f.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/415fa29b.js","path":"static/js/415fa29b.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/7d897144.js","path":"static/js/7d897144.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/7e80f274.js","path":"static/js/7e80f274.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/8da07a12.js","path":"static/js/8da07a12.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/9aa0d897.js","path":"static/js/9aa0d897.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/9cb479b5.js","path":"static/js/9cb479b5.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/a92e6a1c.js","path":"static/js/a92e6a1c.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/c562793b.js","path":"static/js/c562793b.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/ff251d5d.js","path":"static/js/ff251d5d.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/d57a5994.js","path":"static/js/d57a5994.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-aurora/source/static/js/fffbee97.js","path":"static/js/fffbee97.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"d6eb417d19c431e592ba69d4824b9da7abb4239e","modified":1720689178760},{"_id":"source/_posts/RNAseq-数据预处理的常规流程.md","hash":"7770abcf91fb6f81d7c0e82894917493d780cfc9","modified":1720784342692},{"_id":"source/about/index.md","hash":"c58fb07426bb427dc5ddd4327e7aede861bc8604","modified":1720683255915},{"_id":"source/img/avatar.jpg","hash":"fbafd8ab3fc9162f91fcb1b5daf77f7b23a137f9","modified":1720756632159},{"_id":"source/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg","hash":"b66c26ac1ecbc13ad33b4d2ce23ccf68117a4114","modified":1720781145434},{"_id":"source/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg","hash":"c292e184e6c7a9d3ee69802f586c0e5f2b788991","modified":1720781146439},{"_id":"source/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg","hash":"4dc7af0a994ea9ef6ea8181f5d9e14dce0998a5c","modified":1720781144440},{"_id":"source/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg","hash":"4db3c476aed3e06d8c4199c436679ab37c630b10","modified":1720781148493},{"_id":"source/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg","hash":"79cbf6e1eb3333c44de341e7618002e94e69ec02","modified":1720781147466},{"_id":"source/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg","hash":"5383659b1e615921926e51d52fbea6fe0fc0d891","modified":1720781149461},{"_id":"source/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg","hash":"a38c619d12e406f289b6e45674ef564c0aec9935","modified":1720781150471},{"_id":"node_modules/hexo-theme-aurora/LICENSE","hash":"21cf269018b0cf04e1126b6b9b1a5e6af7c5e61f","modified":1720682994197},{"_id":"node_modules/hexo-theme-aurora/README.md","hash":"8b5aea1bd91a6428040ec154ef313d20129fd1ce","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/package.json","hash":"953a91ce5eb62368e3fe1d335e8ccd024983b4fb","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/layout/index.ejs","hash":"c5825d6aed607fd4c5d85d261aed39e2d9d59c81","modified":1720682994228},{"_id":"node_modules/hexo-theme-aurora/public/favicon.ico","hash":"c39d3ad80489cffed0d3df82c8cb05a049ab39a3","modified":1720682994228},{"_id":"node_modules/hexo-theme-aurora/source/favicon.ico","hash":"c39d3ad80489cffed0d3df82c8cb05a049ab39a3","modified":1720682994228},{"_id":"node_modules/hexo-theme-aurora/public/icons/favicon-32x32.png","hash":"9dbabf6f4d825da99dcb2e91583755ae8d3b3ff4","modified":1720682994306},{"_id":"node_modules/hexo-theme-aurora/public/icons/favicon-16x16.png","hash":"849cad2a5ae49fa54c20372f7a21ae95192bafcf","modified":1720682994306},{"_id":"node_modules/hexo-theme-aurora/source/icons/favicon-16x16.png","hash":"849cad2a5ae49fa54c20372f7a21ae95192bafcf","modified":1720682994306},{"_id":"node_modules/hexo-theme-aurora/source/icons/favicon-32x32.png","hash":"9dbabf6f4d825da99dcb2e91583755ae8d3b3ff4","modified":1720682994306},{"_id":"node_modules/hexo-theme-aurora/source/static/886a749e.css","hash":"46ef385b52d11142f603d0916042be66e4e04b46","modified":1720682994212},{"_id":"node_modules/hexo-theme-aurora/source/static/css/3e25f349.css","hash":"2859941dbaabcdf25bfb6379a0efaf6b02b45971","modified":1720682994197},{"_id":"node_modules/hexo-theme-aurora/source/static/css/882f9706.css","hash":"156eb90b06b5f6f6f0bf24973874ecd85906f8fd","modified":1720682994212},{"_id":"node_modules/hexo-theme-aurora/source/static/css/6b275704.css","hash":"b04a2cd1a356e16cded5392bad271ce2f5b1c455","modified":1720682994212},{"_id":"node_modules/hexo-theme-aurora/source/static/css/8e0e69c4.css","hash":"5e2ac4baf9923ea59d1dbddccb44a0e4ffbdc87f","modified":1720682994212},{"_id":"node_modules/hexo-theme-aurora/source/static/css/9a0271b0.css","hash":"140052b8339ae6633bfdb6544050ba97c72ee630","modified":1720682994212},{"_id":"node_modules/hexo-theme-aurora/source/static/img/dccf965f.jpg","hash":"1934ace0c6f2397d15729f9b08cc4d42e45bf437","modified":1720682994228},{"_id":"node_modules/hexo-theme-aurora/source/static/js/22ac7e7f.js","hash":"cdc1e66e812e4ce762170e6c2008a89ddb50ac22","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/36429e9b.js","hash":"f1eb144273d1914ffd000cd6ab8ebf4603566fa1","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/53ed1a6f.js","hash":"392525c36d6f623723427c09a42cc7178f0aa65c","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/415fa29b.js","hash":"8bbf6514805e9634eeb37d58ab9476fe7b4acab9","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/7d897144.js","hash":"bc14613b9e836e8802949241e443176c3923a4ae","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/7e80f274.js","hash":"3e055cf0e8e1e795571b0ac307ebd9d055874bd9","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/8da07a12.js","hash":"bbf25dc2749fc8ec6cd379e69a27d5e5ee116da1","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/9aa0d897.js","hash":"da073d8793e58e2bd92cd879d753966950ea6d7e","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/9cb479b5.js","hash":"41d6681d53d8ca77f4df159d831237550a80939c","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/a92e6a1c.js","hash":"15838a598d2c67734d4e28d6667a148e3315862f","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/c562793b.js","hash":"ef13be62aaee32758e059e625e6b85504c53f822","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/ff251d5d.js","hash":"21fe31757fa0993c2a3d34009b8fa19e421e4dfb","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/d57a5994.js","hash":"baeabc2ef1f3ed1b2f651a436032cedc42e16d78","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/js/fffbee97.js","hash":"6a539112698cb0925ea4da8af22f3e8cdc554e3f","modified":1720682994291},{"_id":"node_modules/hexo-theme-aurora/source/static/css/a14e1a22.css","hash":"d4f364239f1c63b66b9917062e6a7cd9fa26fcba","modified":1720682994212},{"_id":"node_modules/hexo-theme-aurora/source/static/js/120aa8f8.js","hash":"84afbda7eecf891fae3fdac5219582c322d903ee","modified":1720682994275},{"_id":"public/api/posts/1.json","hash":"f4cb1251464bdd690a1baf5ac396e6d9726201bb","modified":1720796942662},{"_id":"public/api/archives/1.json","hash":"f4cb1251464bdd690a1baf5ac396e6d9726201bb","modified":1720796942662},{"_id":"public/api/articles/RNAseq-数据预处理的常规流程.json","hash":"2d6bb922ce0e3637920f270b28d9fca4d13bc079","modified":1720796942662},{"_id":"public/api/features.json","hash":"97d170e1550eee4afc0af065b78cda302a97674c","modified":1720796942662},{"_id":"public/api/authors/blog-author.json","hash":"a577974a41764f47c1d3e5475d6460e9a870c004","modified":1720796942662},{"_id":"public/api/categories.json","hash":"f7a53968065fa1fea841ba75bdadf8b5ea68887b","modified":1720796942662},{"_id":"public/api/categories/生物信息学.json","hash":"149026d1d4f5b4c8f43fbea63624f351df48df30","modified":1720796942662},{"_id":"public/api/tags.json","hash":"5d039672d15e76f3b33889f97f1b3124a277cff8","modified":1720796942662},{"_id":"public/api/tags/生物信息学.json","hash":"149026d1d4f5b4c8f43fbea63624f351df48df30","modified":1720796942662},{"_id":"public/api/tags/bulk-seq.json","hash":"285c84795e9125ee338b94d59e8062a7365e7885","modified":1720796942662},{"_id":"public/api/pages/about/index.json","hash":"b5a2c3e46e90cf0cf9acc14dc09b6b88b910ad7b","modified":1720796942662},{"_id":"public/api/statistic.json","hash":"0646baf10472d13141d6cbfa1e491199eaa41233","modified":1720796942662},{"_id":"public/api/search.json","hash":"541c2215972309269fc45d96afaed661b4df2677","modified":1720796942662},{"_id":"public/api/site.json","hash":"90f9c67bb6870a241f102cee89b30c9e1557f3c7","modified":1720796942662},{"_id":"public/post/RNAseq-数据预处理的常规流程.html","hash":"8befb659037ff0398cdeeee13fe0e86e43f45fec","modified":1720796942662},{"_id":"public/index.html","hash":"8befb659037ff0398cdeeee13fe0e86e43f45fec","modified":1720796942662},{"_id":"public/tags/index.html","hash":"bbf149b1336dbf84d1485637aaadd31c0c1d5112","modified":1720796942662},{"_id":"public/archives/index.html","hash":"bbf149b1336dbf84d1485637aaadd31c0c1d5112","modified":1720796942662},{"_id":"public/page/about/index.html","hash":"bbf149b1336dbf84d1485637aaadd31c0c1d5112","modified":1720796942662},{"_id":"public/tags/search/index.html","hash":"bbf149b1336dbf84d1485637aaadd31c0c1d5112","modified":1720796942662},{"_id":"public/tags/生物信息学/index.html","hash":"bbf149b1336dbf84d1485637aaadd31c0c1d5112","modified":1720796942662},{"_id":"public/tags/bulk-seq/index.html","hash":"bbf149b1336dbf84d1485637aaadd31c0c1d5112","modified":1720796942662},{"_id":"public/CNAME","hash":"d6eb417d19c431e592ba69d4824b9da7abb4239e","modified":1720796942662},{"_id":"public/favicon.ico","hash":"c39d3ad80489cffed0d3df82c8cb05a049ab39a3","modified":1720796942662},{"_id":"public/icons/favicon-16x16.png","hash":"849cad2a5ae49fa54c20372f7a21ae95192bafcf","modified":1720796942662},{"_id":"public/icons/favicon-32x32.png","hash":"9dbabf6f4d825da99dcb2e91583755ae8d3b3ff4","modified":1720796942662},{"_id":"public/static/img/dccf965f.jpg","hash":"1934ace0c6f2397d15729f9b08cc4d42e45bf437","modified":1720796942662},{"_id":"public/css/prism-tomorrow.css","hash":"3b99487dfc9b4e51e9105a93743b92a761840e34","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg","hash":"b66c26ac1ecbc13ad33b4d2ce23ccf68117a4114","modified":1720796942662},{"_id":"public/img/avatar.jpg","hash":"fbafd8ab3fc9162f91fcb1b5daf77f7b23a137f9","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg","hash":"4db3c476aed3e06d8c4199c436679ab37c630b10","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg","hash":"c292e184e6c7a9d3ee69802f586c0e5f2b788991","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg","hash":"5383659b1e615921926e51d52fbea6fe0fc0d891","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg","hash":"79cbf6e1eb3333c44de341e7618002e94e69ec02","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg","hash":"4dc7af0a994ea9ef6ea8181f5d9e14dce0998a5c","modified":1720796942662},{"_id":"public/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg","hash":"a38c619d12e406f289b6e45674ef564c0aec9935","modified":1720796942662},{"_id":"public/static/886a749e.css","hash":"46ef385b52d11142f603d0916042be66e4e04b46","modified":1720796942662},{"_id":"public/static/css/3e25f349.css","hash":"2859941dbaabcdf25bfb6379a0efaf6b02b45971","modified":1720796942662},{"_id":"public/static/css/882f9706.css","hash":"156eb90b06b5f6f6f0bf24973874ecd85906f8fd","modified":1720796942662},{"_id":"public/static/css/8e0e69c4.css","hash":"5e2ac4baf9923ea59d1dbddccb44a0e4ffbdc87f","modified":1720796942662},{"_id":"public/static/css/9a0271b0.css","hash":"140052b8339ae6633bfdb6544050ba97c72ee630","modified":1720796942662},{"_id":"public/static/css/6b275704.css","hash":"b04a2cd1a356e16cded5392bad271ce2f5b1c455","modified":1720796942662},{"_id":"public/static/css/a14e1a22.css","hash":"d4f364239f1c63b66b9917062e6a7cd9fa26fcba","modified":1720796942662},{"_id":"public/static/js/22ac7e7f.js","hash":"cdc1e66e812e4ce762170e6c2008a89ddb50ac22","modified":1720796942662},{"_id":"public/static/js/36429e9b.js","hash":"f1eb144273d1914ffd000cd6ab8ebf4603566fa1","modified":1720796942662},{"_id":"public/static/js/53ed1a6f.js","hash":"392525c36d6f623723427c09a42cc7178f0aa65c","modified":1720796942662},{"_id":"public/static/js/415fa29b.js","hash":"8bbf6514805e9634eeb37d58ab9476fe7b4acab9","modified":1720796942662},{"_id":"public/static/js/7d897144.js","hash":"bc14613b9e836e8802949241e443176c3923a4ae","modified":1720796942662},{"_id":"public/static/js/7e80f274.js","hash":"3e055cf0e8e1e795571b0ac307ebd9d055874bd9","modified":1720796942662},{"_id":"public/static/js/8da07a12.js","hash":"bbf25dc2749fc8ec6cd379e69a27d5e5ee116da1","modified":1720796942662},{"_id":"public/static/js/9aa0d897.js","hash":"da073d8793e58e2bd92cd879d753966950ea6d7e","modified":1720796942662},{"_id":"public/static/js/9cb479b5.js","hash":"41d6681d53d8ca77f4df159d831237550a80939c","modified":1720796942662},{"_id":"public/static/js/a92e6a1c.js","hash":"15838a598d2c67734d4e28d6667a148e3315862f","modified":1720796942662},{"_id":"public/static/js/c562793b.js","hash":"ef13be62aaee32758e059e625e6b85504c53f822","modified":1720796942662},{"_id":"public/static/js/ff251d5d.js","hash":"21fe31757fa0993c2a3d34009b8fa19e421e4dfb","modified":1720796942662},{"_id":"public/static/js/fffbee97.js","hash":"6a539112698cb0925ea4da8af22f3e8cdc554e3f","modified":1720796942662},{"_id":"public/static/js/d57a5994.js","hash":"baeabc2ef1f3ed1b2f651a436032cedc42e16d78","modified":1720796942662},{"_id":"public/static/js/120aa8f8.js","hash":"84afbda7eecf891fae3fdac5219582c322d903ee","modified":1720796942662}],"Category":[{"name":"生物信息学","_id":"clyiu2jcp0002wcv7fmgucmf4"}],"Data":[],"Page":[{"title":"about","date":"2024-07-11T07:34:15.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2024-07-11 15:34:15\n---\n","updated":"2024-07-11T07:34:15.915Z","path":"about/index.html","comments":1,"layout":"page","_id":"clyiu2jcl0000wcv72z13aa3n","content":"","excerpt":"","more":""}],"Post":[{"title":"RNAseq 数据预处理的常规流程","date":"2024-07-12T06:54:56.000Z","cover":"/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg","mathjax":true,"_content":"\n# RNAseq 数据预处理的常规流程\n\n## 目录\n\n0. <a href='#0'>环境设置</a>\n1. <a href='#1'>数据展示</a>\n2. <a href='#2'>数据质量检测</a>\n3. <a href='#3'>过滤低表达基因</a>\n4. <a href='#4'>数据标准化</a>\n5. <a href='#5'>去批次</a>\n6. <a href='#6'>处理后质量检测</a>\n\n## <div id='0'>0. 环境设置</div>\n读入本次实验需要用到的数据包。\n\n```R\nlibrary(tidyverse) # 格式整理\nlibrary(data.table) # 读入文件\nlibrary(clusterProfiler) # Gene ID 转换为 Gene Symbol\nlibrary(org.Hs.eg.db) # 人类基因组注释文件\nlibrary(FactoMineR) # 计算 PCA\nlibrary(factoextra) # PCA 画图\nlibrary(pheatmap) # 热图\nlibrary(ggplot2) # 画图\nlibrary(reshape2) # 长宽表转换\nlibrary(edgeR) # 去除低表达基因 \n```\n\n## <div id='1'>1. 数据展示</div>\n\n此次演示中使用来自 GSE222699 的 RNAseq 数据，数据从 GEO 官网下载。\n\n```tree\nGSE222699_RAW\n├─ GSM6929162_HDMB03_CTRL_1.txt.gz\n├─ GSM6929163_HDMB03_CTRL_2.txt.gz\n├─ GSM6929164_HDMB03_CTRL_3.txt.gz\n├─ GSM6929165_HDMB03_CTRL_4.txt.gz\n├─ GSM6929166_HDMB03_CTRL_1.txt.gz\n├─ GSM6929167_HDMB03_CTRL_2.txt.gz\n├─ GSM6929168_HDMB03_CTRL_3.txt.gz\n└─ GSM6929169_HDMB03_CTRL_4.txt.gz\n```\n\n### 1.1 读入数据\n\n这组数据并没有将所有样本整合为一个表达矩阵，而是每个样本各有一个文件，因此我们首先整理表达矩阵。\n\n```R\n# 将所有文件列入一个列表\nfiles <- list.files(\n    path = \"data/GSE222699_RAW/\",\n    full.names = TRUE\n)\n\n# 读入列表中的第一个文件作为模板\n# 因为文件属于 .gz 压缩文件，直接用 fread 读入后再转换为 data.frame，这是一种更方便的操作\ncounts <- fread(files[[1]]) %>%\n    as.data.frame()\n\n# 从第二个文件开始，读入后与前几个文件合并\nfor (file in files[2:length(files)]) {\n    tmp <- fread(file) %>%\n        as.data.frame()\n    counts <- merge(counts, tmp, by = \"V1\")\n}\n\n# 查看合并后的表达矩阵\nView(counts)\n```\n\n|   |        V1          | HDMB03_shCTRL_1 | HDMB03_shCTRL_2 | HDMB03_shCTRL_3 | HDMB03_shCTRL_4 | HDMB03_shPPHLN1_1 | HDMB03_shPPHLN1_2 | HDMB03_shPPHLN1_3 | HDMB03_shPPHLN1_4 |\n|---|--------------------|-----------------|-----------------|-----------------|-----------------|-------------------|-------------------|-------------------|--------|\n| 1 | ENSG00000000003    |        1041     |        966      |       828       |     1053        |    1334           |   1563            |  1157             | 1258   |\n| 2 | ENSG00000000005    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |\n| 3 | ENSG00000000419    |        1118     |       1382      |       999       |     1414        |    1140           |   1648            |  1067             | 1168   |\n| 4 | ENSG00000000457    |         315     |        394      |       369       |      344        |     482           |    595            |   435             |  388   |\n| 5 | ENSG00000000460    |         447     |        436      |       439       |      411        |     479           |    635            |   496             |  339   |\n| 6 | ENSG00000000938    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |\n\n### 1.2 Gene ID 转换为 Gene Symbol\n\n可以看到，合并后的矩阵以 Gene ID 表示基因，这不利于我们后续对基因的阅读，需要转换为方便阅读的 Gene Symbol。\n\n```R\n# 通过 clusterProfiler 中的 bitr() 函数将 Gene ID 与 Symbol 一一对应\n# drop = FALSE 是指无法 mapping 到 Symbol 的 Gene ID 依然保留在表中，方便后续的合并\n# 如果 drop = TRUE，那么无法 mapping 的 Gene ID 会被舍去，id2symbol 的顺序就会和 counts 不同，不利于合并\nid2symbol <- bitr(\n    geneID = counts$V1,\n    fromType = \"ENSEMBL\",\n    toType = \"SYMBOL\",\n    OrgDb = org.Hs.eg.db,\n    drop = FALSE\n)\n\n# 消除对应到多个 Symbol 的 Gene ID，只保留 mapping 到的第一个 Symbol\n# duplicated() 代表重复的元素，对其取反 !duplicated() 代表不重复的元素\nid2symbol <- id2symbol[which(!duplicated(id2symbol$ENSEMBL)), ]\n\n# 比对 id2symbol 与 counts 是否一一对应\ntable(id2symbol$ENSEMBL == counts$V1) # TRUE\n\n# 将 Gene Symbol 合并入 counts\ncounts$Symbol <- id2symbol$SYMBOL\n\n# 去除没有 mapping 到的 Gene ID\n# na.omit() 去除包含 NA 的行\ncounts <- na.omit(counts)\n\n# 查看 ID 转换后的表达矩阵\nView(counts)\n```\n\n|   |        V1          | HDMB03_shCTRL_1 | HDMB03_shCTRL_2 | HDMB03_shCTRL_3 | HDMB03_shCTRL_4 | HDMB03_shPPHLN1_1 | HDMB03_shPPHLN1_2 | HDMB03_shPPHLN1_3 | HDMB03_shPPHLN1_4 | Symbol |\n|---|--------------------|-----------------|-----------------|-----------------|-----------------|-------------------|-------------------|-------------------|--------|-------|\n| 1 | ENSG00000000003    |        1041     |        966      |       828       |     1053        |    1334           |   1563            |  1157             | 1258   |TSPAN6 |\n| 2 | ENSG00000000005    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |  TNMD |\n| 3 | ENSG00000000419    |        1118     |       1382      |       999       |     1414        |    1140           |   1648            |  1067             | 1168   |  DPM1 |\n| 4 | ENSG00000000457    |         315     |        394      |       369       |      344        |     482           |    595            |   435             |  388   | SCYL3 |\n| 5 | ENSG00000000460    |         447     |        436      |       439       |      411        |     479           |    635            |   496             |  339   | FIRRM |\n| 6 | ENSG00000000938    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |   FGR |\n\n### 1.3 消除重复的基因\n\n多个 Gene ID 常常对应到同一个 Gene Symbol，导致矩阵中出现重复的基因名，需要想办法去除。\n\n```R\n# 去除 Gene ID 这一列\n# [, -1] 代表去除第一列\ncounts <- counts[, -1]\n\n# 取出重复的基因与不重复的基因\n# 查看有多少重复的基因\ntable(duplicated(counts$Symbol))\n\n# 取出重复基因所在的行号\ndupl <- duplicated(counts$Symbol)\n\n# 取出重复的基因名\ngeneDupl <- counts$Symbol[dupl]\n\n# 取出重复的基因所在的行\n# 这边不直接使用 duplicated() 函数，是因为 duplicated() 函数不会取出第一项重复的元素\n# 比如如果一个元素共重复了 5 次， duplicated() 只会取出后 4 次，而忽略第 1 次\ncountsDupl <- subset(\n    x = counts,\n    subset = Symbol %in% geneDupl\n)\n\n# 不在 geneDupl 中的基因则认为是 unique 的基因\ncountsUniq <- subset(\n    x = counts,\n    subset = !(Symbol %in% geneDupl)\n)\n\n# 合并重复的基因\n# 合并的方法有很多种，包括：均数 mean，中位数 median，最大值 max\n# 因为此处的数据类型为 Raw counts，为了尽量保护其整数性，此处选择使用 median\ncountsDupl <- aggregate(\n    x = .~Symbol,\n    data = countsDupl,\n    FUN = median\n)\n\n# 将合并好的重复基因与非重复基因合并，得到完整的表达矩阵\ncounts <- rbind(\n    countsDupl, countsUniq,\n    deparse.level = 2\n)\n\n# 将 Gene Symbol 转换为行名\ncounts <- counts %>%\n    remove_rownames() %>%\n    column_to_rownames(var = \"Symbol\")\n\n# Counts 取整数\n# 即使是使用 median 处理重复基因，也难以避免 .5 的出现，因此依然需要四舍五入 round()\ncounts <- round(counts)\n\n# 查看处理后的表达矩阵\nView(counts)\n```\n\n|       | HDMB03_shCTRL_1 | HDMB03_shCTRL_2 | HDMB03_shCTRL_3 | HDMB03_shCTRL_4 | HDMB03_shPPHLN1_1 | HDMB03_shPPHLN1_2 | HDMB03_shPPHLN1_3 | HDMB03_shPPHLN1_4 |\n|-------|-----------------|-----------------|-----------------|-----------------|-------------------|-------------------|-------------------|-------------------|\n|ARL17A |             84  |            90   |           88    |          70     |           98      |         103       |       102         |       78          |\n|BAZ2B  |            694  |           730   |          674    |         734     |          672      |         930       |       778         |      752          |\n|BOLA2  |              2  |             0   |            2    |           6     |            0      |           0       |         0         |        0          |\n|CCNYL6 |              1  |             2   |            0    |           1     |            0      |           0       |         1         |        3          |\n|CKMT1B |            490  |           726   |          641    |         476     |          554      |         622       |       524         |      396          |\n|CRHR1  |             22  |            18   |           32    |          40     |           24      |          43       |        36         |       26          |\n\n## <div id='2'>2. 数据质量检测</div>\n\n### 2.0 分组\n\n该数据共分为 2 组，4 个对照组 Ctrl 与 4 个实验组 PPHLN1。\n\n```R\ngroup <- data.frame(\n    group = rep(\n        x = c(\"Ctrl\", \"PPHLN1\"), # 2 组\n        each = 4 # 各 4 个\n    ),\n    row.names = colnames(counts) # 行名即样本名\n)\n```\n\n### 2.1 PCA\n\nPCA （主成分分析）是一种数据降维方法。\n1. 首先，所有的数据以其每个基因为基底，张成一个高维空间，而每个样本在这个高维空间中具有一个唯一的坐标 (x1, x2, ... , xn)：\n    1. 计算高维空间中各个方向上样本间的方差，取方差最大的方向上的向量作为其主成分向量，记作 PC_1；\n    2. 显然，在 PC_1 上，样本的分布最为分散，不同样本间的区分度也就最高；\n2. 在垂直于 PC_1 的各个方向上，取方差最大的方向上的向量，记作 PC_2：\n   1. PC_1 与 PC_2 共同张成一个正交的二维平面；\n   2. 显然，在这一平面上，各个样本间的分布最为分散，不同样本间的区分度也就最高；\n3. 在由 PC_1 与 PC_2 张成的二维平面上考察不同分组的样本的分布模式，理想的情况下：\n   1. 处于同一分组的样本之间的位置最为接近；\n   2. 处于不同分组的样本之间的位置相距最远。\n\n\n\n``` R\npcaBefore <- PCA(\n    X = t(counts),\n    graph = FALSE # 计算时不画图\n)\npicPcaBefore <- fviz_pca_ind(\n    X = pcaBefore,\n    col.ind = group$group, # 规定各组的颜色\n    repel = TRUE, # 文字标签之间不重叠\n    addEllipses = TRUE # 加入椭圆形，每组不多于 3 个样本时无法加入椭圆\n                       # （五点确定一个椭圆，因此至少需要五个自由度，而对于不精确的拟合，可以只用 4 个点）\n)\nprint(picPcaBefore)\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg\">\n\n### 2.2 相关性热图\n计算各个样本之间的相关性，以热图的形式展示，理想情况下：\n1. 同属一组的样本之间相关性最高；\n2. 属于不同组的样本之间相关性最低。\n\n```R\npicHeatmapBefore <- pheatmap(\n    mat = counts %>% cor(), # 计算相关性矩阵\n    annotation_row = group, # 行色块标签，表示分组\n    annotation_col = group, # 列色块标签，表示分组\n    legend = TRUE, # 显示色条图注\n    annotation_legend = FALSE, # 不显示分组图注\n    cutree_rows = 2, # 根据树状图分为两行\n    cutree_cols = 2, # 根据树状图分为两列\n    color = colorRampPalette(c(\"blue\", \"white\", \"red\"))(100) # 规定颜色为 (蓝, 白, 红)，过渡为 100\n)\nplot.new() # 新建画布\nprint(picHeatmapBefore) # 画图\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg\">\n\n### 2.3 箱线图\n通过箱线图表示各个样本的分布，以考察各个样本是否属于同分布；\n\n若样本间的分布不同，不利于后续的统计学分析，需要进行标准化；\n\n由于 Raw counts 符合负二项分布，因此需要取 log2(counts+1) 使其接近正态分布。\n\n```R\npicBoxplotBefore <- (counts+1) %>% log2() %>% # 取 log2(counts+1)\n    melt() %>% # 将宽表形式的表达矩阵转换为长表形式，便于画图\n    ggplot + # 画图开始\n    geom_boxplot( # 画箱线图\n        mapping = aes(\n            x = variable, # x 轴为样本\n            y = value # y 轴为基因表达量\n        )\n    ) +\n    labs(x = \"Sample\", y = \"Expression\") + # 指定 x 轴与 y 轴的标题\n    theme_bw() + # 方框空白主题\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1) # x 轴标签旋转 45 度并右对齐\n    )\nplot.new() # 新建画布\nprint(picBoxplotBefore) # 画图\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg\">\n\n## <div id='3'>3. 过滤低表达基因</div>\n\n观察到箱线图中的中位数线位于 0，说明存在大量低表达甚至不表达的基因；\n\n考虑到 $\\frac{0}{0}$ 无意义，会影响后续的差异倍数的计算；\n\n因此需要去除低表达的基因；\n\n此处使用 edgeR 包中的 filterByExpr() 函数。\n\n```R\n# 过滤低表达基因\nkeep <- filterByExpr(\n    counts,\n    group = group$group\n)\n\n# 取出过滤后仍保留的行\ncountsRLE <- counts[keep, ]\n\n# 制图\npicBoxplotRLE <- (countsRLE+1) %>% log2() %>% # log2(counts+1)\n    melt() %>%\n    ggplot +\n    geom_boxplot(\n        mapping = aes(\n            x = variable,\n            y = value\n        )\n    ) +\n    labs(x = \"Sample\", y = \"Expression\") +\n    theme_bw() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1)\n    )\n\n# 画图\nprint(picBoxplotRLE)\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg\">\n\n经过过滤低表达基因后，可以看到，箱线图中的中位数线位于箱子的正中间，说明现在的表达量分布接近正态分布。\n\n## <div id='4'>4. 数据标准化</div>\n\n观察经过过滤后的箱线图，可以发现，虽然大体上的分布趋势相似，但是箱子的高度仍然有细微的差别；\n\n我们可以使用 limma 包中的 normalizeBetweenArrays() 函数进行优化\n\n```R\ncountsNorm <- normalizeBetweenArrays(countsRLE)\npicBoxplotAfter <- (countsNorm+1) %>% log2() %>%\n    melt() %>%\n    ggplot +\n    geom_boxplot(\n        mapping = aes(\n            x = Var2,\n            y = value\n        )\n    ) +\n    labs(x = \"Sample\", y = \"Expression\") +\n    theme_bw() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1)\n    )\nprint(picBoxplotAfter)\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">\n\n可以看到，经过标准化后的数据分布完全一致，有利于我们下一步的分析\n\n## <div id='5'>5. 去批次</div>\n\n此次实验中的样本全部来自一次测序结果，因此不存在批次效应；\n\n若实验中的样本是多次测序汇总的结果，则不同的测序批次之间存在批次效应，需要去除；\n\n去除批次效应可以使用 sva 包中的 ComBat() 函数以及 limma 包中的 removeBatchEffect() 函数；\n\n因为后续的差异分析主要基于 limma 包，因此此处也主要介绍 limma 包中的方法。\n\n```R\n# 将分组信息转化为实验设计矩阵\ndesign <- model.matrix(~0+group$group)\n\n# 提供批次信息\nbatch <- data.frame(\n    batch = c(...) # 此处填入批次信息\n    row.names = col.names(countsNorm) # 行名来自样本名\n)\n\n# 去批次\ncountsRBE <- removeBatchEffect(\n    counts,\n    batch = batch$batch, # 去除批次效应\n    design = design # 保留生物学效应\n)\n```\n\n去批次后，可以再使用 PCA 方法验证去批次的效果。\n\n## <div id='6'>6. 处理后质量检测</div>\n\n同样使用 PCA、相关性热图、箱线图三种方法；\n\n代码不赘述\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">","source":"_posts/RNAseq-数据预处理的常规流程.md","raw":"---\ntitle: RNAseq 数据预处理的常规流程\ndate: 2024-07-12 14:54:56\ntags: \n    - 生物信息学\n    - bulk seq\ncategories:\n    - 生物信息学\ncover: /img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg\nmathjax: true\n---\n\n# RNAseq 数据预处理的常规流程\n\n## 目录\n\n0. <a href='#0'>环境设置</a>\n1. <a href='#1'>数据展示</a>\n2. <a href='#2'>数据质量检测</a>\n3. <a href='#3'>过滤低表达基因</a>\n4. <a href='#4'>数据标准化</a>\n5. <a href='#5'>去批次</a>\n6. <a href='#6'>处理后质量检测</a>\n\n## <div id='0'>0. 环境设置</div>\n读入本次实验需要用到的数据包。\n\n```R\nlibrary(tidyverse) # 格式整理\nlibrary(data.table) # 读入文件\nlibrary(clusterProfiler) # Gene ID 转换为 Gene Symbol\nlibrary(org.Hs.eg.db) # 人类基因组注释文件\nlibrary(FactoMineR) # 计算 PCA\nlibrary(factoextra) # PCA 画图\nlibrary(pheatmap) # 热图\nlibrary(ggplot2) # 画图\nlibrary(reshape2) # 长宽表转换\nlibrary(edgeR) # 去除低表达基因 \n```\n\n## <div id='1'>1. 数据展示</div>\n\n此次演示中使用来自 GSE222699 的 RNAseq 数据，数据从 GEO 官网下载。\n\n```tree\nGSE222699_RAW\n├─ GSM6929162_HDMB03_CTRL_1.txt.gz\n├─ GSM6929163_HDMB03_CTRL_2.txt.gz\n├─ GSM6929164_HDMB03_CTRL_3.txt.gz\n├─ GSM6929165_HDMB03_CTRL_4.txt.gz\n├─ GSM6929166_HDMB03_CTRL_1.txt.gz\n├─ GSM6929167_HDMB03_CTRL_2.txt.gz\n├─ GSM6929168_HDMB03_CTRL_3.txt.gz\n└─ GSM6929169_HDMB03_CTRL_4.txt.gz\n```\n\n### 1.1 读入数据\n\n这组数据并没有将所有样本整合为一个表达矩阵，而是每个样本各有一个文件，因此我们首先整理表达矩阵。\n\n```R\n# 将所有文件列入一个列表\nfiles <- list.files(\n    path = \"data/GSE222699_RAW/\",\n    full.names = TRUE\n)\n\n# 读入列表中的第一个文件作为模板\n# 因为文件属于 .gz 压缩文件，直接用 fread 读入后再转换为 data.frame，这是一种更方便的操作\ncounts <- fread(files[[1]]) %>%\n    as.data.frame()\n\n# 从第二个文件开始，读入后与前几个文件合并\nfor (file in files[2:length(files)]) {\n    tmp <- fread(file) %>%\n        as.data.frame()\n    counts <- merge(counts, tmp, by = \"V1\")\n}\n\n# 查看合并后的表达矩阵\nView(counts)\n```\n\n|   |        V1          | HDMB03_shCTRL_1 | HDMB03_shCTRL_2 | HDMB03_shCTRL_3 | HDMB03_shCTRL_4 | HDMB03_shPPHLN1_1 | HDMB03_shPPHLN1_2 | HDMB03_shPPHLN1_3 | HDMB03_shPPHLN1_4 |\n|---|--------------------|-----------------|-----------------|-----------------|-----------------|-------------------|-------------------|-------------------|--------|\n| 1 | ENSG00000000003    |        1041     |        966      |       828       |     1053        |    1334           |   1563            |  1157             | 1258   |\n| 2 | ENSG00000000005    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |\n| 3 | ENSG00000000419    |        1118     |       1382      |       999       |     1414        |    1140           |   1648            |  1067             | 1168   |\n| 4 | ENSG00000000457    |         315     |        394      |       369       |      344        |     482           |    595            |   435             |  388   |\n| 5 | ENSG00000000460    |         447     |        436      |       439       |      411        |     479           |    635            |   496             |  339   |\n| 6 | ENSG00000000938    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |\n\n### 1.2 Gene ID 转换为 Gene Symbol\n\n可以看到，合并后的矩阵以 Gene ID 表示基因，这不利于我们后续对基因的阅读，需要转换为方便阅读的 Gene Symbol。\n\n```R\n# 通过 clusterProfiler 中的 bitr() 函数将 Gene ID 与 Symbol 一一对应\n# drop = FALSE 是指无法 mapping 到 Symbol 的 Gene ID 依然保留在表中，方便后续的合并\n# 如果 drop = TRUE，那么无法 mapping 的 Gene ID 会被舍去，id2symbol 的顺序就会和 counts 不同，不利于合并\nid2symbol <- bitr(\n    geneID = counts$V1,\n    fromType = \"ENSEMBL\",\n    toType = \"SYMBOL\",\n    OrgDb = org.Hs.eg.db,\n    drop = FALSE\n)\n\n# 消除对应到多个 Symbol 的 Gene ID，只保留 mapping 到的第一个 Symbol\n# duplicated() 代表重复的元素，对其取反 !duplicated() 代表不重复的元素\nid2symbol <- id2symbol[which(!duplicated(id2symbol$ENSEMBL)), ]\n\n# 比对 id2symbol 与 counts 是否一一对应\ntable(id2symbol$ENSEMBL == counts$V1) # TRUE\n\n# 将 Gene Symbol 合并入 counts\ncounts$Symbol <- id2symbol$SYMBOL\n\n# 去除没有 mapping 到的 Gene ID\n# na.omit() 去除包含 NA 的行\ncounts <- na.omit(counts)\n\n# 查看 ID 转换后的表达矩阵\nView(counts)\n```\n\n|   |        V1          | HDMB03_shCTRL_1 | HDMB03_shCTRL_2 | HDMB03_shCTRL_3 | HDMB03_shCTRL_4 | HDMB03_shPPHLN1_1 | HDMB03_shPPHLN1_2 | HDMB03_shPPHLN1_3 | HDMB03_shPPHLN1_4 | Symbol |\n|---|--------------------|-----------------|-----------------|-----------------|-----------------|-------------------|-------------------|-------------------|--------|-------|\n| 1 | ENSG00000000003    |        1041     |        966      |       828       |     1053        |    1334           |   1563            |  1157             | 1258   |TSPAN6 |\n| 2 | ENSG00000000005    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |  TNMD |\n| 3 | ENSG00000000419    |        1118     |       1382      |       999       |     1414        |    1140           |   1648            |  1067             | 1168   |  DPM1 |\n| 4 | ENSG00000000457    |         315     |        394      |       369       |      344        |     482           |    595            |   435             |  388   | SCYL3 |\n| 5 | ENSG00000000460    |         447     |        436      |       439       |      411        |     479           |    635            |   496             |  339   | FIRRM |\n| 6 | ENSG00000000938    |           0     |          0      |         0       |        0        |       0           |      0            |     0             |    0   |   FGR |\n\n### 1.3 消除重复的基因\n\n多个 Gene ID 常常对应到同一个 Gene Symbol，导致矩阵中出现重复的基因名，需要想办法去除。\n\n```R\n# 去除 Gene ID 这一列\n# [, -1] 代表去除第一列\ncounts <- counts[, -1]\n\n# 取出重复的基因与不重复的基因\n# 查看有多少重复的基因\ntable(duplicated(counts$Symbol))\n\n# 取出重复基因所在的行号\ndupl <- duplicated(counts$Symbol)\n\n# 取出重复的基因名\ngeneDupl <- counts$Symbol[dupl]\n\n# 取出重复的基因所在的行\n# 这边不直接使用 duplicated() 函数，是因为 duplicated() 函数不会取出第一项重复的元素\n# 比如如果一个元素共重复了 5 次， duplicated() 只会取出后 4 次，而忽略第 1 次\ncountsDupl <- subset(\n    x = counts,\n    subset = Symbol %in% geneDupl\n)\n\n# 不在 geneDupl 中的基因则认为是 unique 的基因\ncountsUniq <- subset(\n    x = counts,\n    subset = !(Symbol %in% geneDupl)\n)\n\n# 合并重复的基因\n# 合并的方法有很多种，包括：均数 mean，中位数 median，最大值 max\n# 因为此处的数据类型为 Raw counts，为了尽量保护其整数性，此处选择使用 median\ncountsDupl <- aggregate(\n    x = .~Symbol,\n    data = countsDupl,\n    FUN = median\n)\n\n# 将合并好的重复基因与非重复基因合并，得到完整的表达矩阵\ncounts <- rbind(\n    countsDupl, countsUniq,\n    deparse.level = 2\n)\n\n# 将 Gene Symbol 转换为行名\ncounts <- counts %>%\n    remove_rownames() %>%\n    column_to_rownames(var = \"Symbol\")\n\n# Counts 取整数\n# 即使是使用 median 处理重复基因，也难以避免 .5 的出现，因此依然需要四舍五入 round()\ncounts <- round(counts)\n\n# 查看处理后的表达矩阵\nView(counts)\n```\n\n|       | HDMB03_shCTRL_1 | HDMB03_shCTRL_2 | HDMB03_shCTRL_3 | HDMB03_shCTRL_4 | HDMB03_shPPHLN1_1 | HDMB03_shPPHLN1_2 | HDMB03_shPPHLN1_3 | HDMB03_shPPHLN1_4 |\n|-------|-----------------|-----------------|-----------------|-----------------|-------------------|-------------------|-------------------|-------------------|\n|ARL17A |             84  |            90   |           88    |          70     |           98      |         103       |       102         |       78          |\n|BAZ2B  |            694  |           730   |          674    |         734     |          672      |         930       |       778         |      752          |\n|BOLA2  |              2  |             0   |            2    |           6     |            0      |           0       |         0         |        0          |\n|CCNYL6 |              1  |             2   |            0    |           1     |            0      |           0       |         1         |        3          |\n|CKMT1B |            490  |           726   |          641    |         476     |          554      |         622       |       524         |      396          |\n|CRHR1  |             22  |            18   |           32    |          40     |           24      |          43       |        36         |       26          |\n\n## <div id='2'>2. 数据质量检测</div>\n\n### 2.0 分组\n\n该数据共分为 2 组，4 个对照组 Ctrl 与 4 个实验组 PPHLN1。\n\n```R\ngroup <- data.frame(\n    group = rep(\n        x = c(\"Ctrl\", \"PPHLN1\"), # 2 组\n        each = 4 # 各 4 个\n    ),\n    row.names = colnames(counts) # 行名即样本名\n)\n```\n\n### 2.1 PCA\n\nPCA （主成分分析）是一种数据降维方法。\n1. 首先，所有的数据以其每个基因为基底，张成一个高维空间，而每个样本在这个高维空间中具有一个唯一的坐标 (x1, x2, ... , xn)：\n    1. 计算高维空间中各个方向上样本间的方差，取方差最大的方向上的向量作为其主成分向量，记作 PC_1；\n    2. 显然，在 PC_1 上，样本的分布最为分散，不同样本间的区分度也就最高；\n2. 在垂直于 PC_1 的各个方向上，取方差最大的方向上的向量，记作 PC_2：\n   1. PC_1 与 PC_2 共同张成一个正交的二维平面；\n   2. 显然，在这一平面上，各个样本间的分布最为分散，不同样本间的区分度也就最高；\n3. 在由 PC_1 与 PC_2 张成的二维平面上考察不同分组的样本的分布模式，理想的情况下：\n   1. 处于同一分组的样本之间的位置最为接近；\n   2. 处于不同分组的样本之间的位置相距最远。\n\n\n\n``` R\npcaBefore <- PCA(\n    X = t(counts),\n    graph = FALSE # 计算时不画图\n)\npicPcaBefore <- fviz_pca_ind(\n    X = pcaBefore,\n    col.ind = group$group, # 规定各组的颜色\n    repel = TRUE, # 文字标签之间不重叠\n    addEllipses = TRUE # 加入椭圆形，每组不多于 3 个样本时无法加入椭圆\n                       # （五点确定一个椭圆，因此至少需要五个自由度，而对于不精确的拟合，可以只用 4 个点）\n)\nprint(picPcaBefore)\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg\">\n\n### 2.2 相关性热图\n计算各个样本之间的相关性，以热图的形式展示，理想情况下：\n1. 同属一组的样本之间相关性最高；\n2. 属于不同组的样本之间相关性最低。\n\n```R\npicHeatmapBefore <- pheatmap(\n    mat = counts %>% cor(), # 计算相关性矩阵\n    annotation_row = group, # 行色块标签，表示分组\n    annotation_col = group, # 列色块标签，表示分组\n    legend = TRUE, # 显示色条图注\n    annotation_legend = FALSE, # 不显示分组图注\n    cutree_rows = 2, # 根据树状图分为两行\n    cutree_cols = 2, # 根据树状图分为两列\n    color = colorRampPalette(c(\"blue\", \"white\", \"red\"))(100) # 规定颜色为 (蓝, 白, 红)，过渡为 100\n)\nplot.new() # 新建画布\nprint(picHeatmapBefore) # 画图\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg\">\n\n### 2.3 箱线图\n通过箱线图表示各个样本的分布，以考察各个样本是否属于同分布；\n\n若样本间的分布不同，不利于后续的统计学分析，需要进行标准化；\n\n由于 Raw counts 符合负二项分布，因此需要取 log2(counts+1) 使其接近正态分布。\n\n```R\npicBoxplotBefore <- (counts+1) %>% log2() %>% # 取 log2(counts+1)\n    melt() %>% # 将宽表形式的表达矩阵转换为长表形式，便于画图\n    ggplot + # 画图开始\n    geom_boxplot( # 画箱线图\n        mapping = aes(\n            x = variable, # x 轴为样本\n            y = value # y 轴为基因表达量\n        )\n    ) +\n    labs(x = \"Sample\", y = \"Expression\") + # 指定 x 轴与 y 轴的标题\n    theme_bw() + # 方框空白主题\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1) # x 轴标签旋转 45 度并右对齐\n    )\nplot.new() # 新建画布\nprint(picBoxplotBefore) # 画图\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg\">\n\n## <div id='3'>3. 过滤低表达基因</div>\n\n观察到箱线图中的中位数线位于 0，说明存在大量低表达甚至不表达的基因；\n\n考虑到 $\\frac{0}{0}$ 无意义，会影响后续的差异倍数的计算；\n\n因此需要去除低表达的基因；\n\n此处使用 edgeR 包中的 filterByExpr() 函数。\n\n```R\n# 过滤低表达基因\nkeep <- filterByExpr(\n    counts,\n    group = group$group\n)\n\n# 取出过滤后仍保留的行\ncountsRLE <- counts[keep, ]\n\n# 制图\npicBoxplotRLE <- (countsRLE+1) %>% log2() %>% # log2(counts+1)\n    melt() %>%\n    ggplot +\n    geom_boxplot(\n        mapping = aes(\n            x = variable,\n            y = value\n        )\n    ) +\n    labs(x = \"Sample\", y = \"Expression\") +\n    theme_bw() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1)\n    )\n\n# 画图\nprint(picBoxplotRLE)\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg\">\n\n经过过滤低表达基因后，可以看到，箱线图中的中位数线位于箱子的正中间，说明现在的表达量分布接近正态分布。\n\n## <div id='4'>4. 数据标准化</div>\n\n观察经过过滤后的箱线图，可以发现，虽然大体上的分布趋势相似，但是箱子的高度仍然有细微的差别；\n\n我们可以使用 limma 包中的 normalizeBetweenArrays() 函数进行优化\n\n```R\ncountsNorm <- normalizeBetweenArrays(countsRLE)\npicBoxplotAfter <- (countsNorm+1) %>% log2() %>%\n    melt() %>%\n    ggplot +\n    geom_boxplot(\n        mapping = aes(\n            x = Var2,\n            y = value\n        )\n    ) +\n    labs(x = \"Sample\", y = \"Expression\") +\n    theme_bw() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1)\n    )\nprint(picBoxplotAfter)\n```\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">\n\n可以看到，经过标准化后的数据分布完全一致，有利于我们下一步的分析\n\n## <div id='5'>5. 去批次</div>\n\n此次实验中的样本全部来自一次测序结果，因此不存在批次效应；\n\n若实验中的样本是多次测序汇总的结果，则不同的测序批次之间存在批次效应，需要去除；\n\n去除批次效应可以使用 sva 包中的 ComBat() 函数以及 limma 包中的 removeBatchEffect() 函数；\n\n因为后续的差异分析主要基于 limma 包，因此此处也主要介绍 limma 包中的方法。\n\n```R\n# 将分组信息转化为实验设计矩阵\ndesign <- model.matrix(~0+group$group)\n\n# 提供批次信息\nbatch <- data.frame(\n    batch = c(...) # 此处填入批次信息\n    row.names = col.names(countsNorm) # 行名来自样本名\n)\n\n# 去批次\ncountsRBE <- removeBatchEffect(\n    counts,\n    batch = batch$batch, # 去除批次效应\n    design = design # 保留生物学效应\n)\n```\n\n去批次后，可以再使用 PCA 方法验证去批次的效果。\n\n## <div id='6'>6. 处理后质量检测</div>\n\n同样使用 PCA、相关性热图、箱线图三种方法；\n\n代码不赘述\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">","slug":"RNAseq-数据预处理的常规流程","published":1,"updated":"2024-07-12T11:39:02.692Z","comments":1,"layout":"post","photos":[],"_id":"clyiu2jcn0001wcv7cnc31s3c","content":"<h1 id=\"RNAseq-数据预处理的常规流程\"><a href=\"#RNAseq-数据预处理的常规流程\" class=\"headerlink\" title=\"RNAseq 数据预处理的常规流程\"></a>RNAseq 数据预处理的常规流程</h1><h2 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h2><ol start=\"0\">\n<li><a href=\"#0\">环境设置</a></li>\n<li><a href=\"#1\">数据展示</a></li>\n<li><a href=\"#2\">数据质量检测</a></li>\n<li><a href=\"#3\">过滤低表达基因</a></li>\n<li><a href=\"#4\">数据标准化</a></li>\n<li><a href=\"#5\">去批次</a></li>\n<li><a href=\"#6\">处理后质量检测</a></li>\n</ol>\n<h2 id=\"0-环境设置\"><a href=\"#0-环境设置\" class=\"headerlink\" title=\"0. 环境设置\"></a><div id=\"0\">0. 环境设置</div></h2><p>读入本次实验需要用到的数据包。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(tidyverse) </span><span style=\"color: #6A737D\"># 格式整理</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(data.table) </span><span style=\"color: #6A737D\"># 读入文件</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(clusterProfiler) </span><span style=\"color: #6A737D\"># Gene ID 转换为 Gene Symbol</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(org.Hs.eg.db) </span><span style=\"color: #6A737D\"># 人类基因组注释文件</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(FactoMineR) </span><span style=\"color: #6A737D\"># 计算 PCA</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(factoextra) </span><span style=\"color: #6A737D\"># PCA 画图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(pheatmap) </span><span style=\"color: #6A737D\"># 热图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(ggplot2) </span><span style=\"color: #6A737D\"># 画图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(reshape2) </span><span style=\"color: #6A737D\"># 长宽表转换</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(edgeR) </span><span style=\"color: #6A737D\"># 去除低表达基因 </span></span></code></pre></div><h2 id=\"1-数据展示\"><a href=\"#1-数据展示\" class=\"headerlink\" title=\"1. 数据展示\"></a><div id=\"1\">1. 数据展示</div></h2><p>此次演示中使用来自 GSE222699 的 RNAseq 数据，数据从 GEO 官网下载。</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292e\">GSE222699_RAW</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929162_HDMB03_CTRL_1.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929163_HDMB03_CTRL_2.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929164_HDMB03_CTRL_3.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929165_HDMB03_CTRL_4.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929166_HDMB03_CTRL_1.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929167_HDMB03_CTRL_2.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929168_HDMB03_CTRL_3.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">└─ GSM6929169_HDMB03_CTRL_4.txt.gz</span></span></code></pre></div><h3 id=\"1-1-读入数据\"><a href=\"#1-1-读入数据\" class=\"headerlink\" title=\"1.1 读入数据\"></a>1.1 读入数据</h3><p>这组数据并没有将所有样本整合为一个表达矩阵，而是每个样本各有一个文件，因此我们首先整理表达矩阵。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 将所有文件列入一个列表</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">files </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">list.files</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">path</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"data/GSE222699_RAW/\"</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">full.names</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">TRUE</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 读入列表中的第一个文件作为模板</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 因为文件属于 .gz 压缩文件，直接用 fread 读入后再转换为 data.frame，这是一种更方便的操作</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fread</span><span style=\"color: #24292E\">(files[[</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">]]) </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">as.data.frame</span><span style=\"color: #24292E\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 从第二个文件开始，读入后与前几个文件合并</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">for</span><span style=\"color: #24292E\"> (file </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> files[</span><span style=\"color: #005CC5\">2</span><span style=\"color: #D73A49\">:</span><span style=\"color: #005CC5\">length</span><span style=\"color: #24292E\">(files)]) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    tmp </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fread</span><span style=\"color: #24292E\">(file) </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">as.data.frame</span><span style=\"color: #24292E\">()</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">merge</span><span style=\"color: #24292E\">(counts, tmp, </span><span style=\"color: #E36209\">by</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"V1\"</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看合并后的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">View</span><span style=\"color: #24292E\">(counts)</span></span></code></pre></div><table>\n<thead>\n<tr>\n<th></th>\n<th>V1</th>\n<th>HDMB03_shCTRL_1</th>\n<th>HDMB03_shCTRL_2</th>\n<th>HDMB03_shCTRL_3</th>\n<th>HDMB03_shCTRL_4</th>\n<th>HDMB03_shPPHLN1_1</th>\n<th>HDMB03_shPPHLN1_2</th>\n<th>HDMB03_shPPHLN1_3</th>\n<th>HDMB03_shPPHLN1_4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>ENSG00000000003</td>\n<td>1041</td>\n<td>966</td>\n<td>828</td>\n<td>1053</td>\n<td>1334</td>\n<td>1563</td>\n<td>1157</td>\n<td>1258</td>\n</tr>\n<tr>\n<td>2</td>\n<td>ENSG00000000005</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>3</td>\n<td>ENSG00000000419</td>\n<td>1118</td>\n<td>1382</td>\n<td>999</td>\n<td>1414</td>\n<td>1140</td>\n<td>1648</td>\n<td>1067</td>\n<td>1168</td>\n</tr>\n<tr>\n<td>4</td>\n<td>ENSG00000000457</td>\n<td>315</td>\n<td>394</td>\n<td>369</td>\n<td>344</td>\n<td>482</td>\n<td>595</td>\n<td>435</td>\n<td>388</td>\n</tr>\n<tr>\n<td>5</td>\n<td>ENSG00000000460</td>\n<td>447</td>\n<td>436</td>\n<td>439</td>\n<td>411</td>\n<td>479</td>\n<td>635</td>\n<td>496</td>\n<td>339</td>\n</tr>\n<tr>\n<td>6</td>\n<td>ENSG00000000938</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n</tr>\n</tbody></table>\n<h3 id=\"1-2-Gene-ID-转换为-Gene-Symbol\"><a href=\"#1-2-Gene-ID-转换为-Gene-Symbol\" class=\"headerlink\" title=\"1.2 Gene ID 转换为 Gene Symbol\"></a>1.2 Gene ID 转换为 Gene Symbol</h3><p>可以看到，合并后的矩阵以 Gene ID 表示基因，这不利于我们后续对基因的阅读，需要转换为方便阅读的 Gene Symbol。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 通过 clusterProfiler 中的 bitr() 函数将 Gene ID 与 Symbol 一一对应</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># drop = FALSE 是指无法 mapping 到 Symbol 的 Gene ID 依然保留在表中，方便后续的合并</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 如果 drop = TRUE，那么无法 mapping 的 Gene ID 会被舍去，id2symbol 的顺序就会和 counts 不同，不利于合并</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">id2symbol </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">bitr</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geneID</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">V1,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">fromType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"ENSEMBL\"</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">toType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"SYMBOL\"</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">OrgDb</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> org.Hs.eg.db,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">drop</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">FALSE</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 消除对应到多个 Symbol 的 Gene ID，只保留 mapping 到的第一个 Symbol</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># duplicated() 代表重复的元素，对其取反 !duplicated() 代表不重复的元素</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">id2symbol </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> id2symbol[</span><span style=\"color: #005CC5\">which</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">!</span><span style=\"color: #005CC5\">duplicated</span><span style=\"color: #24292E\">(id2symbol</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">ENSEMBL)), ]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 比对 id2symbol 与 counts 是否一一对应</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">table</span><span style=\"color: #24292E\">(id2symbol</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">ENSEMBL </span><span style=\"color: #D73A49\">==</span><span style=\"color: #24292E\"> counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">V1) </span><span style=\"color: #6A737D\"># TRUE</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 将 Gene Symbol 合并入 counts</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> id2symbol</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">SYMBOL</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 去除没有 mapping 到的 Gene ID</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># na.omit() 去除包含 NA 的行</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">na.omit</span><span style=\"color: #24292E\">(counts)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看 ID 转换后的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">View</span><span style=\"color: #24292E\">(counts)</span></span></code></pre></div><table>\n<thead>\n<tr>\n<th></th>\n<th>V1</th>\n<th>HDMB03_shCTRL_1</th>\n<th>HDMB03_shCTRL_2</th>\n<th>HDMB03_shCTRL_3</th>\n<th>HDMB03_shCTRL_4</th>\n<th>HDMB03_shPPHLN1_1</th>\n<th>HDMB03_shPPHLN1_2</th>\n<th>HDMB03_shPPHLN1_3</th>\n<th>HDMB03_shPPHLN1_4</th>\n<th>Symbol</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>ENSG00000000003</td>\n<td>1041</td>\n<td>966</td>\n<td>828</td>\n<td>1053</td>\n<td>1334</td>\n<td>1563</td>\n<td>1157</td>\n<td>1258</td>\n<td>TSPAN6</td>\n</tr>\n<tr>\n<td>2</td>\n<td>ENSG00000000005</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>TNMD</td>\n</tr>\n<tr>\n<td>3</td>\n<td>ENSG00000000419</td>\n<td>1118</td>\n<td>1382</td>\n<td>999</td>\n<td>1414</td>\n<td>1140</td>\n<td>1648</td>\n<td>1067</td>\n<td>1168</td>\n<td>DPM1</td>\n</tr>\n<tr>\n<td>4</td>\n<td>ENSG00000000457</td>\n<td>315</td>\n<td>394</td>\n<td>369</td>\n<td>344</td>\n<td>482</td>\n<td>595</td>\n<td>435</td>\n<td>388</td>\n<td>SCYL3</td>\n</tr>\n<tr>\n<td>5</td>\n<td>ENSG00000000460</td>\n<td>447</td>\n<td>436</td>\n<td>439</td>\n<td>411</td>\n<td>479</td>\n<td>635</td>\n<td>496</td>\n<td>339</td>\n<td>FIRRM</td>\n</tr>\n<tr>\n<td>6</td>\n<td>ENSG00000000938</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>FGR</td>\n</tr>\n</tbody></table>\n<h3 id=\"1-3-消除重复的基因\"><a href=\"#1-3-消除重复的基因\" class=\"headerlink\" title=\"1.3 消除重复的基因\"></a>1.3 消除重复的基因</h3><p>多个 Gene ID 常常对应到同一个 Gene Symbol，导致矩阵中出现重复的基因名，需要想办法去除。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 去除 Gene ID 这一列</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># [, -1] 代表去除第一列</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts[, </span><span style=\"color: #D73A49\">-</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复的基因与不重复的基因</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看有多少重复的基因</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">table</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">duplicated</span><span style=\"color: #24292E\">(counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复基因所在的行号</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">dupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">duplicated</span><span style=\"color: #24292E\">(counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复的基因名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">geneDupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol[dupl]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复的基因所在的行</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 这边不直接使用 duplicated() 函数，是因为 duplicated() 函数不会取出第一项重复的元素</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 比如如果一个元素共重复了 5 次， duplicated() 只会取出后 4 次，而忽略第 1 次</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsDupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">subset</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">subset</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> Symbol </span><span style=\"color: #D73A49\">%in%</span><span style=\"color: #24292E\"> geneDupl</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 不在 geneDupl 中的基因则认为是 unique 的基因</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsUniq </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">subset</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">subset</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">!</span><span style=\"color: #24292E\">(Symbol </span><span style=\"color: #D73A49\">%in%</span><span style=\"color: #24292E\"> geneDupl)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 合并重复的基因</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 合并的方法有很多种，包括：均数 mean，中位数 median，最大值 max</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 因为此处的数据类型为 Raw counts，为了尽量保护其整数性，此处选择使用 median</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsDupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">aggregate</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> .</span><span style=\"color: #D73A49\">~</span><span style=\"color: #24292E\">Symbol,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">data</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> countsDupl,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">FUN</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> median</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 将合并好的重复基因与非重复基因合并，得到完整的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">rbind</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    countsDupl, countsUniq,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">deparse.level</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 将 Gene Symbol 转换为行名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">remove_rownames</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">column_to_rownames</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">var</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Symbol\"</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># Counts 取整数</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 即使是使用 median 处理重复基因，也难以避免 .5 的出现，因此依然需要四舍五入 round()</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">round</span><span style=\"color: #24292E\">(counts)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看处理后的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">View</span><span style=\"color: #24292E\">(counts)</span></span></code></pre></div><table>\n<thead>\n<tr>\n<th></th>\n<th>HDMB03_shCTRL_1</th>\n<th>HDMB03_shCTRL_2</th>\n<th>HDMB03_shCTRL_3</th>\n<th>HDMB03_shCTRL_4</th>\n<th>HDMB03_shPPHLN1_1</th>\n<th>HDMB03_shPPHLN1_2</th>\n<th>HDMB03_shPPHLN1_3</th>\n<th>HDMB03_shPPHLN1_4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ARL17A</td>\n<td>84</td>\n<td>90</td>\n<td>88</td>\n<td>70</td>\n<td>98</td>\n<td>103</td>\n<td>102</td>\n<td>78</td>\n</tr>\n<tr>\n<td>BAZ2B</td>\n<td>694</td>\n<td>730</td>\n<td>674</td>\n<td>734</td>\n<td>672</td>\n<td>930</td>\n<td>778</td>\n<td>752</td>\n</tr>\n<tr>\n<td>BOLA2</td>\n<td>2</td>\n<td>0</td>\n<td>2</td>\n<td>6</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>CCNYL6</td>\n<td>1</td>\n<td>2</td>\n<td>0</td>\n<td>1</td>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n<td>3</td>\n</tr>\n<tr>\n<td>CKMT1B</td>\n<td>490</td>\n<td>726</td>\n<td>641</td>\n<td>476</td>\n<td>554</td>\n<td>622</td>\n<td>524</td>\n<td>396</td>\n</tr>\n<tr>\n<td>CRHR1</td>\n<td>22</td>\n<td>18</td>\n<td>32</td>\n<td>40</td>\n<td>24</td>\n<td>43</td>\n<td>36</td>\n<td>26</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-数据质量检测\"><a href=\"#2-数据质量检测\" class=\"headerlink\" title=\"2. 数据质量检测\"></a><div id=\"2\">2. 数据质量检测</div></h2><h3 id=\"2-0-分组\"><a href=\"#2-0-分组\" class=\"headerlink\" title=\"2.0 分组\"></a>2.0 分组</h3><p>该数据共分为 2 组，4 个对照组 Ctrl 与 4 个实验组 PPHLN1。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">group </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">data.frame</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">group</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">rep</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">c</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">\"Ctrl\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">\"PPHLN1\"</span><span style=\"color: #24292E\">), </span><span style=\"color: #6A737D\"># 2 组</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">each</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">4</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 各 4 个</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ),</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">row.names</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">colnames</span><span style=\"color: #24292E\">(counts) </span><span style=\"color: #6A737D\"># 行名即样本名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span></code></pre></div><h3 id=\"2-1-PCA\"><a href=\"#2-1-PCA\" class=\"headerlink\" title=\"2.1 PCA\"></a>2.1 PCA</h3><p>PCA （主成分分析）是一种数据降维方法。</p>\n<ol>\n<li>首先，所有的数据以其每个基因为基底，张成一个高维空间，而每个样本在这个高维空间中具有一个唯一的坐标 (x1, x2, … , xn)：<ol>\n<li>计算高维空间中各个方向上样本间的方差，取方差最大的方向上的向量作为其主成分向量，记作 PC_1；</li>\n<li>显然，在 PC_1 上，样本的分布最为分散，不同样本间的区分度也就最高；</li>\n</ol>\n</li>\n<li>在垂直于 PC_1 的各个方向上，取方差最大的方向上的向量，记作 PC_2：<ol>\n<li>PC_1 与 PC_2 共同张成一个正交的二维平面；</li>\n<li>显然，在这一平面上，各个样本间的分布最为分散，不同样本间的区分度也就最高；</li>\n</ol>\n</li>\n<li>在由 PC_1 与 PC_2 张成的二维平面上考察不同分组的样本的分布模式，理想的情况下：<ol>\n<li>处于同一分组的样本之间的位置最为接近；</li>\n<li>处于不同分组的样本之间的位置相距最远。</li>\n</ol>\n</li>\n</ol>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">pcaBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">PCA</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">X</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">t</span><span style=\"color: #24292E\">(counts),</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">graph</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">FALSE</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 计算时不画图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">picPcaBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fviz_pca_ind</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">X</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> pcaBefore,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">col.ind</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">group, </span><span style=\"color: #6A737D\"># 规定各组的颜色</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">repel</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">TRUE</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 文字标签之间不重叠</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">addEllipses</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> TRUE </span><span style=\"color: #6A737D\"># 加入椭圆形，每组不多于 3 个样本时无法加入椭圆</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                       </span><span style=\"color: #6A737D\"># （五点确定一个椭圆，因此至少需要五个自由度，而对于不精确的拟合，可以只用 4 个点）</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picPcaBefore)</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg\">\n\n<h3 id=\"2-2-相关性热图\"><a href=\"#2-2-相关性热图\" class=\"headerlink\" title=\"2.2 相关性热图\"></a>2.2 相关性热图</h3><p>计算各个样本之间的相关性，以热图的形式展示，理想情况下：</p>\n<ol>\n<li>同属一组的样本之间相关性最高；</li>\n<li>属于不同组的样本之间相关性最低。</li>\n</ol>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">picHeatmapBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">pheatmap</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">mat</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">cor</span><span style=\"color: #24292E\">(), </span><span style=\"color: #6A737D\"># 计算相关性矩阵</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">annotation_row</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group, </span><span style=\"color: #6A737D\"># 行色块标签，表示分组</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">annotation_col</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group, </span><span style=\"color: #6A737D\"># 列色块标签，表示分组</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">legend</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">TRUE</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 显示色条图注</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">annotation_legend</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">FALSE</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 不显示分组图注</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">cutree_rows</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 根据树状图分为两行</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">cutree_cols</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 根据树状图分为两列</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">color</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">colorRampPalette</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">c</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">\"blue\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">\"white\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">\"red\"</span><span style=\"color: #24292E\">))(</span><span style=\"color: #005CC5\">100</span><span style=\"color: #24292E\">) </span><span style=\"color: #6A737D\"># 规定颜色为 (蓝, 白, 红)，过渡为 100</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">plot.new</span><span style=\"color: #24292E\">() </span><span style=\"color: #6A737D\"># 新建画布</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picHeatmapBefore) </span><span style=\"color: #6A737D\"># 画图</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg\">\n\n<h3 id=\"2-3-箱线图\"><a href=\"#2-3-箱线图\" class=\"headerlink\" title=\"2.3 箱线图\"></a>2.3 箱线图</h3><p>通过箱线图表示各个样本的分布，以考察各个样本是否属于同分布；</p>\n<p>若样本间的分布不同，不利于后续的统计学分析，需要进行标准化；</p>\n<p>由于 Raw counts 符合负二项分布，因此需要取 log2(counts+1) 使其接近正态分布。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">picBoxplotBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> (counts</span><span style=\"color: #D73A49\">+</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">log2</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 取 log2(counts+1)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">melt</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 将宽表形式的表达矩阵转换为长表形式，便于画图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ggplot </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 画图开始</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geom_boxplot</span><span style=\"color: #24292E\">( </span><span style=\"color: #6A737D\"># 画箱线图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">mapping</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">aes</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> variable, </span><span style=\"color: #6A737D\"># x 轴为样本</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> value </span><span style=\"color: #6A737D\"># y 轴为基因表达量</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        )</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">labs</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Sample\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Expression\"</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 指定 x 轴与 y 轴的标题</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme_bw</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 方框空白主题</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">axis.text.x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">element_text</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">angle</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">45</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">hjust</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #6A737D\"># x 轴标签旋转 45 度并右对齐</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    )</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">plot.new</span><span style=\"color: #24292E\">() </span><span style=\"color: #6A737D\"># 新建画布</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picBoxplotBefore) </span><span style=\"color: #6A737D\"># 画图</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg\">\n\n<h2 id=\"3-过滤低表达基因\"><a href=\"#3-过滤低表达基因\" class=\"headerlink\" title=\"3. 过滤低表达基因\"></a><div id=\"3\">3. 过滤低表达基因</div></h2><p>观察到箱线图中的中位数线位于 0，说明存在大量低表达甚至不表达的基因；</p>\n<p>考虑到 <mjx-container class=\"MathJax\" jax=\"SVG\"><svg style=\"vertical-align: -0.816ex;\" xmlns=\"http://www.w3.org/2000/svg\" width=\"1.795ex\" height=\"2.773ex\" role=\"img\" focusable=\"false\" viewBox=\"0 -864.9 793.6 1225.5\"><g stroke=\"currentColor\" fill=\"currentColor\" stroke-width=\"0\" transform=\"scale(1,-1)\"><g data-mml-node=\"math\"><g data-mml-node=\"mfrac\"><g data-mml-node=\"mn\" transform=\"translate(220,394) scale(0.707)\"><path data-c=\"30\" d=\"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z\"></path></g><g data-mml-node=\"mn\" transform=\"translate(220,-345) scale(0.707)\"><path data-c=\"30\" d=\"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z\"></path></g><rect width=\"553.6\" height=\"60\" x=\"120\" y=\"220\"></rect></g></g></g></svg></mjx-container> 无意义，会影响后续的差异倍数的计算；</p>\n<p>因此需要去除低表达的基因；</p>\n<p>此处使用 edgeR 包中的 filterByExpr() 函数。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 过滤低表达基因</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">keep </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">filterByExpr</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">group</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">group</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出过滤后仍保留的行</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsRLE </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts[keep, ]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 制图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">picBoxplotRLE </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> (countsRLE</span><span style=\"color: #D73A49\">+</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">log2</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># log2(counts+1)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">melt</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ggplot </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geom_boxplot</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">mapping</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">aes</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> variable,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> value</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        )</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">labs</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Sample\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Expression\"</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme_bw</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">axis.text.x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">element_text</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">angle</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">45</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">hjust</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 画图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picBoxplotRLE)</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg\">\n\n<p>经过过滤低表达基因后，可以看到，箱线图中的中位数线位于箱子的正中间，说明现在的表达量分布接近正态分布。</p>\n<h2 id=\"4-数据标准化\"><a href=\"#4-数据标准化\" class=\"headerlink\" title=\"4. 数据标准化\"></a><div id=\"4\">4. 数据标准化</div></h2><p>观察经过过滤后的箱线图，可以发现，虽然大体上的分布趋势相似，但是箱子的高度仍然有细微的差别；</p>\n<p>我们可以使用 limma 包中的 normalizeBetweenArrays() 函数进行优化</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">countsNorm </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">normalizeBetweenArrays</span><span style=\"color: #24292E\">(countsRLE)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">picBoxplotAfter </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> (countsNorm</span><span style=\"color: #D73A49\">+</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">log2</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">melt</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ggplot </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geom_boxplot</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">mapping</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">aes</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> Var2,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> value</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        )</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">labs</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Sample\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Expression\"</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme_bw</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">axis.text.x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">element_text</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">angle</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">45</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">hjust</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    )</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picBoxplotAfter)</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">\n\n<p>可以看到，经过标准化后的数据分布完全一致，有利于我们下一步的分析</p>\n<h2 id=\"5-去批次\"><a href=\"#5-去批次\" class=\"headerlink\" title=\"5. 去批次\"></a><div id=\"5\">5. 去批次</div></h2><p>此次实验中的样本全部来自一次测序结果，因此不存在批次效应；</p>\n<p>若实验中的样本是多次测序汇总的结果，则不同的测序批次之间存在批次效应，需要去除；</p>\n<p>去除批次效应可以使用 sva 包中的 ComBat() 函数以及 limma 包中的 removeBatchEffect() 函数；</p>\n<p>因为后续的差异分析主要基于 limma 包，因此此处也主要介绍 limma 包中的方法。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 将分组信息转化为实验设计矩阵</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">design </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">model.matrix</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">~</span><span style=\"color: #005CC5\">0</span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\">group</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">group)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 提供批次信息</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">batch </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">data.frame</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">batch</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">c</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">...</span><span style=\"color: #24292E\">) </span><span style=\"color: #6A737D\"># 此处填入批次信息</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">row.names</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">col.names</span><span style=\"color: #24292E\">(countsNorm) </span><span style=\"color: #6A737D\"># 行名来自样本名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 去批次</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsRBE </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">removeBatchEffect</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">batch</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> batch</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">batch, </span><span style=\"color: #6A737D\"># 去除批次效应</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">design</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> design </span><span style=\"color: #6A737D\"># 保留生物学效应</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span></code></pre></div><p>去批次后，可以再使用 PCA 方法验证去批次的效果。</p>\n<h2 id=\"6-处理后质量检测\"><a href=\"#6-处理后质量检测\" class=\"headerlink\" title=\"6. 处理后质量检测\"></a><div id=\"6\">6. 处理后质量检测</div></h2><p>同样使用 PCA、相关性热图、箱线图三种方法；</p>\n<p>代码不赘述</p>\n<img src=\"/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">","excerpt":"","more":"<h1 id=\"RNAseq-数据预处理的常规流程\"><a href=\"#RNAseq-数据预处理的常规流程\" class=\"headerlink\" title=\"RNAseq 数据预处理的常规流程\"></a>RNAseq 数据预处理的常规流程</h1><h2 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h2><ol start=\"0\">\n<li><a href=\"#0\">环境设置</a></li>\n<li><a href=\"#1\">数据展示</a></li>\n<li><a href=\"#2\">数据质量检测</a></li>\n<li><a href=\"#3\">过滤低表达基因</a></li>\n<li><a href=\"#4\">数据标准化</a></li>\n<li><a href=\"#5\">去批次</a></li>\n<li><a href=\"#6\">处理后质量检测</a></li>\n</ol>\n<h2 id=\"0-环境设置\"><a href=\"#0-环境设置\" class=\"headerlink\" title=\"0. 环境设置\"></a><div id=\"0\">0. 环境设置</div></h2><p>读入本次实验需要用到的数据包。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(tidyverse) </span><span style=\"color: #6A737D\"># 格式整理</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(data.table) </span><span style=\"color: #6A737D\"># 读入文件</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(clusterProfiler) </span><span style=\"color: #6A737D\"># Gene ID 转换为 Gene Symbol</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(org.Hs.eg.db) </span><span style=\"color: #6A737D\"># 人类基因组注释文件</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(FactoMineR) </span><span style=\"color: #6A737D\"># 计算 PCA</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(factoextra) </span><span style=\"color: #6A737D\"># PCA 画图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(pheatmap) </span><span style=\"color: #6A737D\"># 热图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(ggplot2) </span><span style=\"color: #6A737D\"># 画图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(reshape2) </span><span style=\"color: #6A737D\"># 长宽表转换</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">library</span><span style=\"color: #24292E\">(edgeR) </span><span style=\"color: #6A737D\"># 去除低表达基因 </span></span></code></pre></div><h2 id=\"1-数据展示\"><a href=\"#1-数据展示\" class=\"headerlink\" title=\"1. 数据展示\"></a><div id=\"1\">1. 数据展示</div></h2><p>此次演示中使用来自 GSE222699 的 RNAseq 数据，数据从 GEO 官网下载。</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292e\">GSE222699_RAW</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929162_HDMB03_CTRL_1.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929163_HDMB03_CTRL_2.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929164_HDMB03_CTRL_3.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929165_HDMB03_CTRL_4.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929166_HDMB03_CTRL_1.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929167_HDMB03_CTRL_2.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">├─ GSM6929168_HDMB03_CTRL_3.txt.gz</span></span>\n<span class=\"line\"><span style=\"color: #24292e\">└─ GSM6929169_HDMB03_CTRL_4.txt.gz</span></span></code></pre></div><h3 id=\"1-1-读入数据\"><a href=\"#1-1-读入数据\" class=\"headerlink\" title=\"1.1 读入数据\"></a>1.1 读入数据</h3><p>这组数据并没有将所有样本整合为一个表达矩阵，而是每个样本各有一个文件，因此我们首先整理表达矩阵。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 将所有文件列入一个列表</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">files </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">list.files</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">path</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"data/GSE222699_RAW/\"</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">full.names</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">TRUE</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 读入列表中的第一个文件作为模板</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 因为文件属于 .gz 压缩文件，直接用 fread 读入后再转换为 data.frame，这是一种更方便的操作</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fread</span><span style=\"color: #24292E\">(files[[</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">]]) </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">as.data.frame</span><span style=\"color: #24292E\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 从第二个文件开始，读入后与前几个文件合并</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">for</span><span style=\"color: #24292E\"> (file </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> files[</span><span style=\"color: #005CC5\">2</span><span style=\"color: #D73A49\">:</span><span style=\"color: #005CC5\">length</span><span style=\"color: #24292E\">(files)]) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    tmp </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fread</span><span style=\"color: #24292E\">(file) </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">as.data.frame</span><span style=\"color: #24292E\">()</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">merge</span><span style=\"color: #24292E\">(counts, tmp, </span><span style=\"color: #E36209\">by</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"V1\"</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看合并后的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">View</span><span style=\"color: #24292E\">(counts)</span></span></code></pre></div><table>\n<thead>\n<tr>\n<th></th>\n<th>V1</th>\n<th>HDMB03_shCTRL_1</th>\n<th>HDMB03_shCTRL_2</th>\n<th>HDMB03_shCTRL_3</th>\n<th>HDMB03_shCTRL_4</th>\n<th>HDMB03_shPPHLN1_1</th>\n<th>HDMB03_shPPHLN1_2</th>\n<th>HDMB03_shPPHLN1_3</th>\n<th>HDMB03_shPPHLN1_4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>ENSG00000000003</td>\n<td>1041</td>\n<td>966</td>\n<td>828</td>\n<td>1053</td>\n<td>1334</td>\n<td>1563</td>\n<td>1157</td>\n<td>1258</td>\n</tr>\n<tr>\n<td>2</td>\n<td>ENSG00000000005</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>3</td>\n<td>ENSG00000000419</td>\n<td>1118</td>\n<td>1382</td>\n<td>999</td>\n<td>1414</td>\n<td>1140</td>\n<td>1648</td>\n<td>1067</td>\n<td>1168</td>\n</tr>\n<tr>\n<td>4</td>\n<td>ENSG00000000457</td>\n<td>315</td>\n<td>394</td>\n<td>369</td>\n<td>344</td>\n<td>482</td>\n<td>595</td>\n<td>435</td>\n<td>388</td>\n</tr>\n<tr>\n<td>5</td>\n<td>ENSG00000000460</td>\n<td>447</td>\n<td>436</td>\n<td>439</td>\n<td>411</td>\n<td>479</td>\n<td>635</td>\n<td>496</td>\n<td>339</td>\n</tr>\n<tr>\n<td>6</td>\n<td>ENSG00000000938</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n</tr>\n</tbody></table>\n<h3 id=\"1-2-Gene-ID-转换为-Gene-Symbol\"><a href=\"#1-2-Gene-ID-转换为-Gene-Symbol\" class=\"headerlink\" title=\"1.2 Gene ID 转换为 Gene Symbol\"></a>1.2 Gene ID 转换为 Gene Symbol</h3><p>可以看到，合并后的矩阵以 Gene ID 表示基因，这不利于我们后续对基因的阅读，需要转换为方便阅读的 Gene Symbol。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 通过 clusterProfiler 中的 bitr() 函数将 Gene ID 与 Symbol 一一对应</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># drop = FALSE 是指无法 mapping 到 Symbol 的 Gene ID 依然保留在表中，方便后续的合并</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 如果 drop = TRUE，那么无法 mapping 的 Gene ID 会被舍去，id2symbol 的顺序就会和 counts 不同，不利于合并</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">id2symbol </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">bitr</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geneID</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">V1,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">fromType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"ENSEMBL\"</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">toType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"SYMBOL\"</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">OrgDb</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> org.Hs.eg.db,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">drop</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">FALSE</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 消除对应到多个 Symbol 的 Gene ID，只保留 mapping 到的第一个 Symbol</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># duplicated() 代表重复的元素，对其取反 !duplicated() 代表不重复的元素</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">id2symbol </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> id2symbol[</span><span style=\"color: #005CC5\">which</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">!</span><span style=\"color: #005CC5\">duplicated</span><span style=\"color: #24292E\">(id2symbol</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">ENSEMBL)), ]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 比对 id2symbol 与 counts 是否一一对应</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">table</span><span style=\"color: #24292E\">(id2symbol</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">ENSEMBL </span><span style=\"color: #D73A49\">==</span><span style=\"color: #24292E\"> counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">V1) </span><span style=\"color: #6A737D\"># TRUE</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 将 Gene Symbol 合并入 counts</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> id2symbol</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">SYMBOL</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 去除没有 mapping 到的 Gene ID</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># na.omit() 去除包含 NA 的行</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">na.omit</span><span style=\"color: #24292E\">(counts)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看 ID 转换后的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">View</span><span style=\"color: #24292E\">(counts)</span></span></code></pre></div><table>\n<thead>\n<tr>\n<th></th>\n<th>V1</th>\n<th>HDMB03_shCTRL_1</th>\n<th>HDMB03_shCTRL_2</th>\n<th>HDMB03_shCTRL_3</th>\n<th>HDMB03_shCTRL_4</th>\n<th>HDMB03_shPPHLN1_1</th>\n<th>HDMB03_shPPHLN1_2</th>\n<th>HDMB03_shPPHLN1_3</th>\n<th>HDMB03_shPPHLN1_4</th>\n<th>Symbol</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>ENSG00000000003</td>\n<td>1041</td>\n<td>966</td>\n<td>828</td>\n<td>1053</td>\n<td>1334</td>\n<td>1563</td>\n<td>1157</td>\n<td>1258</td>\n<td>TSPAN6</td>\n</tr>\n<tr>\n<td>2</td>\n<td>ENSG00000000005</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>TNMD</td>\n</tr>\n<tr>\n<td>3</td>\n<td>ENSG00000000419</td>\n<td>1118</td>\n<td>1382</td>\n<td>999</td>\n<td>1414</td>\n<td>1140</td>\n<td>1648</td>\n<td>1067</td>\n<td>1168</td>\n<td>DPM1</td>\n</tr>\n<tr>\n<td>4</td>\n<td>ENSG00000000457</td>\n<td>315</td>\n<td>394</td>\n<td>369</td>\n<td>344</td>\n<td>482</td>\n<td>595</td>\n<td>435</td>\n<td>388</td>\n<td>SCYL3</td>\n</tr>\n<tr>\n<td>5</td>\n<td>ENSG00000000460</td>\n<td>447</td>\n<td>436</td>\n<td>439</td>\n<td>411</td>\n<td>479</td>\n<td>635</td>\n<td>496</td>\n<td>339</td>\n<td>FIRRM</td>\n</tr>\n<tr>\n<td>6</td>\n<td>ENSG00000000938</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>FGR</td>\n</tr>\n</tbody></table>\n<h3 id=\"1-3-消除重复的基因\"><a href=\"#1-3-消除重复的基因\" class=\"headerlink\" title=\"1.3 消除重复的基因\"></a>1.3 消除重复的基因</h3><p>多个 Gene ID 常常对应到同一个 Gene Symbol，导致矩阵中出现重复的基因名，需要想办法去除。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 去除 Gene ID 这一列</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># [, -1] 代表去除第一列</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts[, </span><span style=\"color: #D73A49\">-</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复的基因与不重复的基因</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看有多少重复的基因</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">table</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">duplicated</span><span style=\"color: #24292E\">(counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复基因所在的行号</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">dupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">duplicated</span><span style=\"color: #24292E\">(counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复的基因名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">geneDupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">Symbol[dupl]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出重复的基因所在的行</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 这边不直接使用 duplicated() 函数，是因为 duplicated() 函数不会取出第一项重复的元素</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 比如如果一个元素共重复了 5 次， duplicated() 只会取出后 4 次，而忽略第 1 次</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsDupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">subset</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">subset</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> Symbol </span><span style=\"color: #D73A49\">%in%</span><span style=\"color: #24292E\"> geneDupl</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 不在 geneDupl 中的基因则认为是 unique 的基因</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsUniq </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">subset</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">subset</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">!</span><span style=\"color: #24292E\">(Symbol </span><span style=\"color: #D73A49\">%in%</span><span style=\"color: #24292E\"> geneDupl)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 合并重复的基因</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 合并的方法有很多种，包括：均数 mean，中位数 median，最大值 max</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 因为此处的数据类型为 Raw counts，为了尽量保护其整数性，此处选择使用 median</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsDupl </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">aggregate</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> .</span><span style=\"color: #D73A49\">~</span><span style=\"color: #24292E\">Symbol,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">data</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> countsDupl,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">FUN</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> median</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 将合并好的重复基因与非重复基因合并，得到完整的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">rbind</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    countsDupl, countsUniq,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">deparse.level</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 将 Gene Symbol 转换为行名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">remove_rownames</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">column_to_rownames</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">var</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Symbol\"</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># Counts 取整数</span></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 即使是使用 median 处理重复基因，也难以避免 .5 的出现，因此依然需要四舍五入 round()</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">counts </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">round</span><span style=\"color: #24292E\">(counts)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 查看处理后的表达矩阵</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">View</span><span style=\"color: #24292E\">(counts)</span></span></code></pre></div><table>\n<thead>\n<tr>\n<th></th>\n<th>HDMB03_shCTRL_1</th>\n<th>HDMB03_shCTRL_2</th>\n<th>HDMB03_shCTRL_3</th>\n<th>HDMB03_shCTRL_4</th>\n<th>HDMB03_shPPHLN1_1</th>\n<th>HDMB03_shPPHLN1_2</th>\n<th>HDMB03_shPPHLN1_3</th>\n<th>HDMB03_shPPHLN1_4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ARL17A</td>\n<td>84</td>\n<td>90</td>\n<td>88</td>\n<td>70</td>\n<td>98</td>\n<td>103</td>\n<td>102</td>\n<td>78</td>\n</tr>\n<tr>\n<td>BAZ2B</td>\n<td>694</td>\n<td>730</td>\n<td>674</td>\n<td>734</td>\n<td>672</td>\n<td>930</td>\n<td>778</td>\n<td>752</td>\n</tr>\n<tr>\n<td>BOLA2</td>\n<td>2</td>\n<td>0</td>\n<td>2</td>\n<td>6</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>CCNYL6</td>\n<td>1</td>\n<td>2</td>\n<td>0</td>\n<td>1</td>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n<td>3</td>\n</tr>\n<tr>\n<td>CKMT1B</td>\n<td>490</td>\n<td>726</td>\n<td>641</td>\n<td>476</td>\n<td>554</td>\n<td>622</td>\n<td>524</td>\n<td>396</td>\n</tr>\n<tr>\n<td>CRHR1</td>\n<td>22</td>\n<td>18</td>\n<td>32</td>\n<td>40</td>\n<td>24</td>\n<td>43</td>\n<td>36</td>\n<td>26</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-数据质量检测\"><a href=\"#2-数据质量检测\" class=\"headerlink\" title=\"2. 数据质量检测\"></a><div id=\"2\">2. 数据质量检测</div></h2><h3 id=\"2-0-分组\"><a href=\"#2-0-分组\" class=\"headerlink\" title=\"2.0 分组\"></a>2.0 分组</h3><p>该数据共分为 2 组，4 个对照组 Ctrl 与 4 个实验组 PPHLN1。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">group </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">data.frame</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">group</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">rep</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">c</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">\"Ctrl\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">\"PPHLN1\"</span><span style=\"color: #24292E\">), </span><span style=\"color: #6A737D\"># 2 组</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">each</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">4</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 各 4 个</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ),</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">row.names</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">colnames</span><span style=\"color: #24292E\">(counts) </span><span style=\"color: #6A737D\"># 行名即样本名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span></code></pre></div><h3 id=\"2-1-PCA\"><a href=\"#2-1-PCA\" class=\"headerlink\" title=\"2.1 PCA\"></a>2.1 PCA</h3><p>PCA （主成分分析）是一种数据降维方法。</p>\n<ol>\n<li>首先，所有的数据以其每个基因为基底，张成一个高维空间，而每个样本在这个高维空间中具有一个唯一的坐标 (x1, x2, … , xn)：<ol>\n<li>计算高维空间中各个方向上样本间的方差，取方差最大的方向上的向量作为其主成分向量，记作 PC_1；</li>\n<li>显然，在 PC_1 上，样本的分布最为分散，不同样本间的区分度也就最高；</li>\n</ol>\n</li>\n<li>在垂直于 PC_1 的各个方向上，取方差最大的方向上的向量，记作 PC_2：<ol>\n<li>PC_1 与 PC_2 共同张成一个正交的二维平面；</li>\n<li>显然，在这一平面上，各个样本间的分布最为分散，不同样本间的区分度也就最高；</li>\n</ol>\n</li>\n<li>在由 PC_1 与 PC_2 张成的二维平面上考察不同分组的样本的分布模式，理想的情况下：<ol>\n<li>处于同一分组的样本之间的位置最为接近；</li>\n<li>处于不同分组的样本之间的位置相距最远。</li>\n</ol>\n</li>\n</ol>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">pcaBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">PCA</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">X</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">t</span><span style=\"color: #24292E\">(counts),</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">graph</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">FALSE</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 计算时不画图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">picPcaBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fviz_pca_ind</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">X</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> pcaBefore,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">col.ind</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">group, </span><span style=\"color: #6A737D\"># 规定各组的颜色</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">repel</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">TRUE</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 文字标签之间不重叠</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">addEllipses</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> TRUE </span><span style=\"color: #6A737D\"># 加入椭圆形，每组不多于 3 个样本时无法加入椭圆</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                       </span><span style=\"color: #6A737D\"># （五点确定一个椭圆，因此至少需要五个自由度，而对于不精确的拟合，可以只用 4 个点）</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picPcaBefore)</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picPcaBefore.jpeg\">\n\n<h3 id=\"2-2-相关性热图\"><a href=\"#2-2-相关性热图\" class=\"headerlink\" title=\"2.2 相关性热图\"></a>2.2 相关性热图</h3><p>计算各个样本之间的相关性，以热图的形式展示，理想情况下：</p>\n<ol>\n<li>同属一组的样本之间相关性最高；</li>\n<li>属于不同组的样本之间相关性最低。</li>\n</ol>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">picHeatmapBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">pheatmap</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">mat</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> counts </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">cor</span><span style=\"color: #24292E\">(), </span><span style=\"color: #6A737D\"># 计算相关性矩阵</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">annotation_row</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group, </span><span style=\"color: #6A737D\"># 行色块标签，表示分组</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">annotation_col</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group, </span><span style=\"color: #6A737D\"># 列色块标签，表示分组</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">legend</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">TRUE</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 显示色条图注</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">annotation_legend</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">FALSE</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 不显示分组图注</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">cutree_rows</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 根据树状图分为两行</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">cutree_cols</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\"># 根据树状图分为两列</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">color</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">colorRampPalette</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">c</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">\"blue\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">\"white\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">\"red\"</span><span style=\"color: #24292E\">))(</span><span style=\"color: #005CC5\">100</span><span style=\"color: #24292E\">) </span><span style=\"color: #6A737D\"># 规定颜色为 (蓝, 白, 红)，过渡为 100</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">plot.new</span><span style=\"color: #24292E\">() </span><span style=\"color: #6A737D\"># 新建画布</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picHeatmapBefore) </span><span style=\"color: #6A737D\"># 画图</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapBefore.jpeg\">\n\n<h3 id=\"2-3-箱线图\"><a href=\"#2-3-箱线图\" class=\"headerlink\" title=\"2.3 箱线图\"></a>2.3 箱线图</h3><p>通过箱线图表示各个样本的分布，以考察各个样本是否属于同分布；</p>\n<p>若样本间的分布不同，不利于后续的统计学分析，需要进行标准化；</p>\n<p>由于 Raw counts 符合负二项分布，因此需要取 log2(counts+1) 使其接近正态分布。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">picBoxplotBefore </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> (counts</span><span style=\"color: #D73A49\">+</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">log2</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 取 log2(counts+1)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">melt</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 将宽表形式的表达矩阵转换为长表形式，便于画图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ggplot </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 画图开始</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geom_boxplot</span><span style=\"color: #24292E\">( </span><span style=\"color: #6A737D\"># 画箱线图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">mapping</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">aes</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> variable, </span><span style=\"color: #6A737D\"># x 轴为样本</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> value </span><span style=\"color: #6A737D\"># y 轴为基因表达量</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        )</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">labs</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Sample\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Expression\"</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 指定 x 轴与 y 轴的标题</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme_bw</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># 方框空白主题</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">axis.text.x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">element_text</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">angle</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">45</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">hjust</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #6A737D\"># x 轴标签旋转 45 度并右对齐</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    )</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">plot.new</span><span style=\"color: #24292E\">() </span><span style=\"color: #6A737D\"># 新建画布</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picBoxplotBefore) </span><span style=\"color: #6A737D\"># 画图</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotBefore.jpeg\">\n\n<h2 id=\"3-过滤低表达基因\"><a href=\"#3-过滤低表达基因\" class=\"headerlink\" title=\"3. 过滤低表达基因\"></a><div id=\"3\">3. 过滤低表达基因</div></h2><p>观察到箱线图中的中位数线位于 0，说明存在大量低表达甚至不表达的基因；</p>\n<p>考虑到 <mjx-container class=\"MathJax\" jax=\"SVG\"><svg style=\"vertical-align: -0.816ex;\" xmlns=\"http://www.w3.org/2000/svg\" width=\"1.795ex\" height=\"2.773ex\" role=\"img\" focusable=\"false\" viewBox=\"0 -864.9 793.6 1225.5\"><g stroke=\"currentColor\" fill=\"currentColor\" stroke-width=\"0\" transform=\"scale(1,-1)\"><g data-mml-node=\"math\"><g data-mml-node=\"mfrac\"><g data-mml-node=\"mn\" transform=\"translate(220,394) scale(0.707)\"><path data-c=\"30\" d=\"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z\"></path></g><g data-mml-node=\"mn\" transform=\"translate(220,-345) scale(0.707)\"><path data-c=\"30\" d=\"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z\"></path></g><rect width=\"553.6\" height=\"60\" x=\"120\" y=\"220\"></rect></g></g></g></svg></mjx-container> 无意义，会影响后续的差异倍数的计算；</p>\n<p>因此需要去除低表达的基因；</p>\n<p>此处使用 edgeR 包中的 filterByExpr() 函数。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 过滤低表达基因</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">keep </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">filterByExpr</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">group</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> group</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">group</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 取出过滤后仍保留的行</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsRLE </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> counts[keep, ]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 制图</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">picBoxplotRLE </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> (countsRLE</span><span style=\"color: #D73A49\">+</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">log2</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\"># log2(counts+1)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">melt</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ggplot </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geom_boxplot</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">mapping</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">aes</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> variable,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> value</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        )</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">labs</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Sample\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Expression\"</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme_bw</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">axis.text.x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">element_text</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">angle</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">45</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">hjust</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 画图</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picBoxplotRLE)</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotRLE.jpeg\">\n\n<p>经过过滤低表达基因后，可以看到，箱线图中的中位数线位于箱子的正中间，说明现在的表达量分布接近正态分布。</p>\n<h2 id=\"4-数据标准化\"><a href=\"#4-数据标准化\" class=\"headerlink\" title=\"4. 数据标准化\"></a><div id=\"4\">4. 数据标准化</div></h2><p>观察经过过滤后的箱线图，可以发现，虽然大体上的分布趋势相似，但是箱子的高度仍然有细微的差别；</p>\n<p>我们可以使用 limma 包中的 normalizeBetweenArrays() 函数进行优化</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">countsNorm </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">normalizeBetweenArrays</span><span style=\"color: #24292E\">(countsRLE)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">picBoxplotAfter </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> (countsNorm</span><span style=\"color: #D73A49\">+</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">%&gt;%</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">log2</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">melt</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">%&gt;%</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ggplot </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">geom_boxplot</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">mapping</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">aes</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> Var2,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> value</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        )</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">labs</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Sample\"</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">y</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">\"Expression\"</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme_bw</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">theme</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">axis.text.x</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">element_text</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">angle</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">45</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">hjust</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    )</span></span>\n<span class=\"line\"><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(picBoxplotAfter)</span></span></code></pre></div><img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">\n\n<p>可以看到，经过标准化后的数据分布完全一致，有利于我们下一步的分析</p>\n<h2 id=\"5-去批次\"><a href=\"#5-去批次\" class=\"headerlink\" title=\"5. 去批次\"></a><div id=\"5\">5. 去批次</div></h2><p>此次实验中的样本全部来自一次测序结果，因此不存在批次效应；</p>\n<p>若实验中的样本是多次测序汇总的结果，则不同的测序批次之间存在批次效应，需要去除；</p>\n<p>去除批次效应可以使用 sva 包中的 ComBat() 函数以及 limma 包中的 removeBatchEffect() 函数；</p>\n<p>因为后续的差异分析主要基于 limma 包，因此此处也主要介绍 limma 包中的方法。</p>\n<div class=\"language-r\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">r</span><pre class=\"shiki github-light\" style=\"background-color: #fcfcfc\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6A737D\"># 将分组信息转化为实验设计矩阵</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">design </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">model.matrix</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">~</span><span style=\"color: #005CC5\">0</span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\">group</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">group)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 提供批次信息</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">batch </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">data.frame</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">batch</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">c</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">...</span><span style=\"color: #24292E\">) </span><span style=\"color: #6A737D\"># 此处填入批次信息</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">row.names</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">col.names</span><span style=\"color: #24292E\">(countsNorm) </span><span style=\"color: #6A737D\"># 行名来自样本名</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #6A737D\"># 去批次</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">countsRBE </span><span style=\"color: #D73A49\">&lt;-</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">removeBatchEffect</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    counts,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">batch</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> batch</span><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\">batch, </span><span style=\"color: #6A737D\"># 去除批次效应</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #E36209\">design</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> design </span><span style=\"color: #6A737D\"># 保留生物学效应</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">)</span></span></code></pre></div><p>去批次后，可以再使用 PCA 方法验证去批次的效果。</p>\n<h2 id=\"6-处理后质量检测\"><a href=\"#6-处理后质量检测\" class=\"headerlink\" title=\"6. 处理后质量检测\"></a><div id=\"6\">6. 处理后质量检测</div></h2><p>同样使用 PCA、相关性热图、箱线图三种方法；</p>\n<p>代码不赘述</p>\n<img src=\"/img/RNAseq_数据预处理的常规流程/picPcaAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picHeatmapAfter.jpeg\">\n\n<img src=\"/img/RNAseq_数据预处理的常规流程/picBoxplotAfter.jpeg\">"}],"PostAsset":[],"PostCategory":[{"post_id":"clyiu2jcn0001wcv7cnc31s3c","category_id":"clyiu2jcp0002wcv7fmgucmf4","_id":"clyiu2jcr0005wcv79oyb0p15"}],"PostTag":[{"post_id":"clyiu2jcn0001wcv7cnc31s3c","tag_id":"clyiu2jcq0003wcv7fna87qk4","_id":"clyiu2jcr0006wcv7h3nvghsz"},{"post_id":"clyiu2jcn0001wcv7cnc31s3c","tag_id":"clyiu2jcr0004wcv7eyh6b9i3","_id":"clyiu2jcr0007wcv7ezpta320"}],"Tag":[{"name":"生物信息学","_id":"clyiu2jcq0003wcv7fna87qk4"},{"name":"bulk seq","_id":"clyiu2jcr0004wcv7eyh6b9i3"}]}}